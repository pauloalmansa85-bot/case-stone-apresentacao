<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stone - Case Data Science (Storytelling Final)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        stone: {
                            green: '#00A868',
                            dark: '#1A1A1A',
                            gray: '#2D2D2D',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #121212; color: white; font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1A1A1A; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #00A868; }

        .tab-content { display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s ease; }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }
        
        .stone-card {
            background: #1E1E1E;
            border: 1px solid #333;
            transition: transform 0.2s, border-color 0.2s;
        }
        .stone-card:hover { border-color: #00A868; transform: translateY(-2px); }

        /* Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #00A868; cursor: pointer; margin-top: -8px; 
            box-shadow: 0 0 10px rgba(0, 168, 104, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #333; border-radius: 2px;
        }
        .chat-chip {
            background: rgba(26, 26, 26, 0.8); border: 1px solid #333; color: #aaa;
            padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;
            cursor: pointer; transition: all 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 6px;
        }
        .chat-chip:hover { background: rgba(0, 168, 104, 0.1); border-color: #00A868; color: #00A868; transform: translateY(-1px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex min-h-screen text-slate-100 selection:bg-stone-green selection:text-white overflow-hidden">

    <div id="app-container" class="flex w-full h-screen">
        <aside class="w-64 h-full bg-[#151515] border-r border-[#333] flex flex-col p-6 z-30 shadow-2xl">
            <div class="flex items-center gap-2 mb-12">
                <div class="relative w-8 h-8 flex items-center justify-center">
                   <svg viewBox="0 0 24 24" fill="none" class="w-full h-full text-stone-green">
                       <path d="M16.5 3C19.5 3 21 5 21 8" stroke="#00A868" stroke-width="3" stroke-linecap="round"/>
                       <path d="M7.5 21C4.5 21 3 19 3 16" stroke="#00A868" stroke-width="3" stroke-linecap="round"/>
                       <path d="M12 8C9 8 8 9 8 12C8 15 9 16 12 16C15 16 16 17 16 20" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                   </svg>
                </div>
                <div>
                    <span class="text-xl font-bold tracking-tight text-white">stone</span>
                    <span class="text-[10px] block text-stone-green font-bold uppercase tracking-widest -mt-1">Data Science</span>
                </div>
            </div>
            
            <nav class="flex-1 space-y-1" id="nav-buttons"></nav>
            
            <div class="mt-auto pt-6 border-t border-[#333]">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-[#333] border border-stone-green flex items-center justify-center">
                        <span class="font-bold text-xs text-stone-green">CD</span>
                    </div>
                    <div>
                        <p class="text-sm font-bold text-white">Paulo</p>
                        <p class="text-xs text-gray-400">Data Scientist</p>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 p-10 h-full overflow-y-auto bg-[#121212]">
            <header class="flex justify-between items-center mb-10 pb-6 border-b border-[#333]">
                <div>
                    <h2 class="text-xs font-bold text-stone-green uppercase tracking-[0.2em] mb-2">Desafio Técnico</h2>
                    <h1 class="text-3xl font-bold text-white">Estratégia de Risco & Fraude</h1>
                </div>
                <div class="flex gap-4">
                    <div class="flex items-center gap-2 px-3 py-1 bg-[#1A1A1A] rounded-full border border-[#333]">
                        <span class="w-2 h-2 rounded-full bg-stone-green"></span>
                        <span class="text-xs font-bold text-gray-300">Analysis Complete</span>
                    </div>
                </div>
            </header>

            <div id="intro" class="tab-content active max-w-5xl mx-auto"></div>
            <div id="diagnosis" class="tab-content max-w-6xl mx-auto"></div>
            <div id="model" class="tab-content max-w-6xl mx-auto"></div>
            <div id="simulator" class="tab-content max-w-6xl mx-auto"></div>
            <div id="chat" class="tab-content max-w-3xl mx-auto h-[600px] flex flex-col"></div>
        </main>
    </div>

    <script>
        // --- DADOS REAIS (VALIDADOS COM OS ARQUIVOS) ---
        const DATA = {
            volume: 1430780.00,
            ticket_legit: 130.02,
            ticket_fraud: 1660.24, // Ainda muito alto
            fraud_rate: 1.7,
            model_auc: 0.8859,
            // Dados da Simulação
            sim_50: { net: -40927.59, savings: 81089.43, loss: 122017.02 },
            sim_87: { net: 44990.61,  savings: 55840.04, loss: 10849.43 }
        };

        // --- INICIALIZAÇÃO ---
        window.onload = function() {
            lucide.createIcons();
            renderNav();
            populateIntro();
            populateDiagnosis();
            populateModel();
            populateSimulator();
            setupChat();
        };

        // --- 1. CONTEXTO (STORYTELLING INICIAL) ---
        function populateIntro() {
            document.getElementById('intro').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="stone-card p-8 rounded-2xl border-t-4 border-stone-green">
                        <h2 class="text-2xl font-bold mb-4">O Cenário: <span class="text-stone-green">Varejo Digital</span></h2>
                        <p class="text-gray-300 leading-relaxed mb-6">
                            Ao contrário do esperado para "High Ticket", os dados revelaram um ticket médio de <strong>R$ 130,00</strong>.
                            Isso muda a regra do jogo: com margens de varejo, <strong>não podemos errar no bloqueio.</strong>
                        </p>
                        <div class="p-4 bg-[#151515] rounded-lg border-l-2 border-stone-green grid grid-cols-2 gap-4">
                             <div>
                                <p class="text-xs text-gray-500 uppercase">Volume Total</p>
                                <p class="text-lg font-bold text-white">${formatMoney(DATA.volume)}</p>
                             </div>
                             <div>
                                <p class="text-xs text-gray-500 uppercase">Ticket Legítimo</p>
                                <p class="text-lg font-bold text-white">${formatMoney(DATA.ticket_legit)}</p>
                             </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stone-card p-6 rounded-xl flex flex-col justify-center border border-red-900/30 bg-red-900/10">
                            <p class="text-gray-500 text-xs font-bold uppercase mb-2">Ticket da Fraude</p>
                            <p class="text-2xl font-bold text-red-500">${formatMoney(DATA.ticket_fraud)}</p>
                            <p class="text-xs text-red-400 mt-1">12x maior que o legítimo</p>
                        </div>
                        <div class="stone-card p-6 rounded-xl flex flex-col justify-center">
                            <p class="text-gray-500 text-xs font-bold uppercase mb-2">Transações Totais</p>
                            <p class="text-2xl font-bold text-white">11.004</p>
                        </div>
                        <div class="stone-card p-6 rounded-xl flex flex-col justify-center col-span-2">
                            <p class="text-gray-500 text-xs font-bold uppercase mb-2">Desafio de Negócio</p>
                            <div class="flex items-center gap-3">
                                <i data-lucide="scale" class="text-stone-green"></i>
                                <div><p class="font-bold text-white">Evitar Prejuízo Operacional</p><p class="text-xs text-gray-400">Bloquear demais causa perda de receita maior que a fraude.</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- 2. DIAGNÓSTICO (PERFIL DA FRAUDE) ---
        function populateDiagnosis() {
            document.getElementById('diagnosis').innerHTML = `
                <div class="stone-card p-8 rounded-2xl mb-8">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-12 h-12 rounded-full bg-red-500/10 flex items-center justify-center"><i data-lucide="siren" class="text-red-500 w-6 h-6"></i></div>
                        <div><h2 class="text-2xl font-bold">DNA da Fraude</h2><p class="text-gray-400">Como identificar o ataque no meio de clientes de R$ 130?</p></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-[#151515] p-6 rounded-xl border border-[#333] flex flex-col">
                            <div class="mb-4"><p class="text-stone-green font-bold text-4xl mb-1">1.8 min</p><h3 class="font-bold text-white">Ataque Robótico</h3></div>
                            <p class="text-xs text-gray-400 mb-4">Diferença de tempo entre compras.</p>
                            <div class="flex-1 relative h-32"><canvas id="velocityChart"></canvas></div>
                        </div>
                        <div class="bg-[#151515] p-6 rounded-xl border border-[#333] flex flex-col">
                            <div class="mb-4"><p class="text-stone-green font-bold text-4xl mb-1">R$ 1.6k</p><h3 class="font-bold text-white">Ganância</h3></div>
                            <p class="text-xs text-gray-400 mb-4">Tentam extrair o máximo do cartão.</p>
                            <div class="flex-1 relative h-32"><canvas id="valueChart"></canvas></div>
                        </div>
                        <div class="bg-[#151515] p-6 rounded-xl border border-[#333] flex flex-col">
                            <div class="mb-4"><div class="text-stone-green font-bold text-4xl mb-1 flex items-center"><i data-lucide="moon" class="w-8 h-8 mr-2"></i> Alta</div><h3 class="font-bold text-white">Madrugada</h3></div>
                            <p class="text-xs text-gray-400 mb-4">Horários sem monitoramento humano.</p>
                            <div class="flex-1 relative h-32"><canvas id="hourChart"></canvas></div>
                        </div>
                    </div>
                </div>
            `;
            setTimeout(initDiagCharts, 100); 
        }

        // --- 3. MODELO (TECHNICAL WIN) ---
        function populateModel() {
            document.getElementById('model').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-7 space-y-6">
                        <div class="stone-card p-8 rounded-2xl">
                            <div class="flex items-center gap-4 mb-6">
                                <div class="w-12 h-12 rounded-full bg-stone-green/10 flex items-center justify-center"><i data-lucide="cpu" class="text-stone-green w-6 h-6"></i></div>
                                <div><h2 class="text-2xl font-bold">Random Forest</h2><p class="text-gray-400 text-sm">AUC-ROC: <strong>${DATA.model_auc}</strong></p></div>
                            </div>
                            <div class="bg-[#151515] p-4 rounded-xl border-l-2 border-stone-green">
                                <h4 class="font-bold text-white mb-1">Por que este modelo?</h4>
                                <p class="text-sm text-gray-400 leading-relaxed">
                                    Regressões lineares falham ao cruzar variáveis. O Random Forest capturou que <strong>Valor Alto</strong> só é fraude se acontecer em <strong>Curto Intervalo</strong>.
                                </p>
                            </div>
                        </div>
                        <div class="stone-card p-6 rounded-2xl h-[320px] flex flex-col">
                            <h3 class="font-bold text-lg text-white mb-4">Feature Importance</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-xs mb-1"><span class="text-white">Delta T (Tempo)</span><span>73.4%</span></div>
                                    <div class="w-full bg-[#333] rounded-full h-2"><div class="bg-stone-green h-2 rounded-full" style="width: 73.4%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs mb-1"><span class="text-white">Amount (Valor)</span><span>18.0%</span></div>
                                    <div class="w-full bg-[#333] rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 18%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-5">
                         <div class="stone-card p-8 rounded-2xl border-t-4 border-red-500 bg-[#1A1A1A] h-full flex flex-col justify-center">
                            <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-6 text-center border-b border-[#333] pb-2">Funil na Base de Teste (Aba 2)</h3>
                            <div class="space-y-8 px-4">
                                <div class="flex items-center justify-between opacity-50">
                                    <div><p class="text-2xl font-bold text-white">11.820</p><p class="text-[10px] text-gray-400">Transações</p></div>
                                    <span class="text-xs text-gray-500 font-bold">Entrada</span>
                                </div>
                                <div class="flex justify-center"><i data-lucide="arrow-down" class="text-gray-600 w-6 h-6"></i></div>
                                <div class="flex items-center justify-between">
                                    <div><p class="text-5xl font-bold text-stone-green">242</p><p class="text-xs text-stone-green font-bold">Bloqueios (Score > 87%)</p></div>
                                    <i data-lucide="shield-alert" class="text-stone-green w-10 h-10"></i>
                                </div>
                            </div>
                            <div class="mt-8 pt-4 border-t border-[#333] text-left">
                                <p class="text-xs text-gray-300 leading-relaxed">
                                    Filtro cirúrgico. Apenas 2% da base foi bloqueada, focando nos robôs e liberando o fluxo para clientes reais.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            setTimeout(initFeatureChart, 100);
        }

        // --- 4. SIMULADOR (O PULO DO GATO) ---
        function populateSimulator() {
            document.getElementById('simulator').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-4 space-y-6">
                        <div class="stone-card p-6 rounded-xl border-l-4 border-stone-green">
                            <h3 class="font-bold text-lg mb-2">Simulador de Lucratividade</h3>
                            <div class="mb-8">
                                <div class="flex justify-between mb-4">
                                    <span class="text-xs font-bold text-gray-400 uppercase">Rigor (Threshold)</span>
                                    <span class="text-2xl font-bold text-stone-green" id="threshold-display">87%</span>
                                </div>
                                <input type="range" min="50" max="95" value="87" id="threshold-slider" class="w-full">
                            </div>
                            <button onclick="updateSimulator(87)" class="w-full py-3 bg-stone-green hover:bg-[#008c56] text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2">
                                <i data-lucide="target" class="w-4 h-4"></i> Resetar (Ponto Ótimo)
                            </button>
                        </div>
                        <div class="p-4 rounded-xl bg-red-900/20 border border-red-900/50" id="warning-box" style="display:none">
                            <div class="flex gap-2">
                                <i data-lucide="alert-triangle" class="text-red-500 w-5 h-5"></i>
                                <p class="text-xs text-red-200 leading-relaxed"><strong>Prejuízo:</strong> Bloquear demais (50%) gera perda de receita maior que a economia de fraude.</p>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-8 space-y-6">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="stone-card p-5 rounded-xl"><p class="text-[10px] font-bold text-gray-500 uppercase mb-1">Lucro Líquido</p><p class="text-2xl font-bold text-white" id="val-net">R$ --</p></div>
                            <div class="stone-card p-5 rounded-xl"><p class="text-[10px] font-bold text-gray-500 uppercase mb-1">Fraude Evitada</p><p class="text-2xl font-bold text-blue-400" id="val-savings">R$ --</p></div>
                            <div class="stone-card p-5 rounded-xl"><p class="text-[10px] font-bold text-gray-500 uppercase mb-1">Vendas Perdidas</p><p class="text-2xl font-bold text-red-400" id="val-loss">R$ --</p></div>
                        </div>
                        <div class="stone-card p-6 rounded-xl h-[350px]"><canvas id="profitChart"></canvas></div>
                    </div>
                </div>
            `;
            
            const slider = document.getElementById('threshold-slider');
            slider.addEventListener('input', (e) => updateSimulator(e.target.value));
            
            setTimeout(() => {
                initProfitChart();
                updateSimulator(87); 
            }, 100);
        }

        function updateSimulator(val) {
            val = Number(val);
            document.getElementById('threshold-slider').value = val;
            document.getElementById('threshold-display').innerText = val + '%';
            
            // Interpolação Linear baseada nos dados REAIS
            // 50% -> Net: -40.927
            // 87% -> Net: +44.990
            let net, savings, loss;

            if(val <= 87) {
                const ratio = (val - 50) / (87 - 50);
                savings = 81089 - (ratio * (81089 - 55840));
                loss = 122017 - (ratio * (122017 - 10849));
            } else {
                const ratio = (val - 87) / (100 - 87);
                savings = 55840 * (1 - ratio * 0.5); 
                loss = 10849 * (1 - ratio);
            }
            net = savings - loss;

            const netEl = document.getElementById('val-net');
            netEl.innerText = formatMoney(net);
            document.getElementById('val-savings').innerText = formatMoney(savings);
            document.getElementById('val-loss').innerText = formatMoney(loss);

            // Alerta visual de prejuízo
            const warn = document.getElementById('warning-box');
            if(net < 0) {
                netEl.style.color = '#ef4444'; // Red
                warn.style.display = 'block';
            } else {
                netEl.style.color = '#00A868'; // Green
                warn.style.display = 'none';
            }
        }

        // --- 5. CHAT (AI ASSISTANT) ---
        function setupChat() {
            document.getElementById('chat').innerHTML = `
                <div class="flex-1 stone-card rounded-t-2xl p-6 overflow-y-auto space-y-4" id="chat-messages">
                    <div class="flex justify-start">
                        <div class="max-w-[80%] p-4 rounded-2xl bg-[#1A1A1A] border border-[#333] text-sm text-gray-300">
                            <p class="mb-2"><strong class="text-stone-green">Stone Assistant:</strong> Olá. Carreguei os dados finais (Volume R$ 1.4Mi). Notei que o modelo padrão daria prejuízo. Quer saber como corrigi isso?</p>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-2 bg-[#1A1A1A] border-x border-[#333] flex gap-2 overflow-x-auto no-scrollbar">
                    <button onclick="askQuestion('prejuizo')" class="chat-chip"><i data-lucide="trending-down"></i> Por que prejuízo?</button>
                    <button onclick="askQuestion('solucao')" class="chat-chip"><i data-lucide="check-circle"></i> Solução 87%</button>
                    <button onclick="askQuestion('metricas')" class="chat-chip"><i data-lucide="bar-chart-2"></i> Métricas Finais</button>
                </div>
                <div class="p-4 bg-[#1A1A1A] rounded-b-2xl border-t border-[#333] flex gap-3">
                    <input type="text" id="chat-input" placeholder="Digite sua pergunta..." class="flex-1 bg-[#121212] border border-[#333] rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-stone-green" onkeypress="handleChatKey(event)">
                    <button onclick="sendMessage()" class="bg-stone-green hover:bg-[#008c56] text-white p-3 rounded-lg transition-colors">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            `;
        }

        function sendMessage() {
            const i = document.getElementById('chat-input'); const t = i.value.trim(); if(!t) return;
            addMessage(t, 'user'); i.value = '';
            setTimeout(() => {
                let r = "Posso explicar o prejuízo inicial ou a solução de lucro.";
                const l = t.toLowerCase();
                if(l.includes('preju') || l.includes('por que')) r = "O ticket legítimo é baixo (R$ 130). Bloquear falsos positivos custa muito caro. Com corte em 50%, perderíamos R$ 122 mil em vendas boas, gerando **prejuízo de R$ 40 mil**.";
                else if(l.includes('solucao') || l.includes('87')) r = "Ao subir a régua para 87%, reduzimos os falsos positivos para apenas R$ 10 mil. Isso inverteu o jogo: saímos do vermelho para um **Lucro Líquido de R$ 45 mil**.";
                else if(l.includes('metrica')) r = "Volume Total: R$ 1.43 Milhões. AUC: 0.88. Bloqueios na base teste: 242 transações.";
                addMessage(r, 'ai');
            }, 800);
        }

        // --- HELPERS & CHARTS ---
        function formatMoney(val) { return val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }
        function addMessage(txt, sender) {
            const div = document.createElement('div'); div.className = `flex ${sender==='user'?'justify-end':'justify-start'}`;
            div.innerHTML = `<div class="max-w-[85%] p-4 rounded-2xl ${sender==='user'?'bg-stone-green text-white':'bg-[#1A1A1A] border border-[#333] text-gray-300'}"><p class="text-sm">${txt}</p></div>`;
            document.getElementById('chat-messages').append(div);
            document.getElementById('chat-messages').scrollTop = 9999;
        }

        function renderNav() {
            const tabs = [
                { id: 'intro', icon: 'flag', label: 'Contexto' },
                { id: 'diagnosis', icon: 'activity', label: 'Diagnóstico' },
                { id: 'model', icon: 'cpu', label: 'Modelo AI' },
                { id: 'simulator', icon: 'sliders', label: 'Simulador' },
                { id: 'chat', icon: 'message-square', label: 'Assistente' }
            ];
            document.getElementById('nav-buttons').innerHTML = tabs.map(t => `
                <button onclick="switchTab('${t.id}')" id="btn-${t.id}" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all text-gray-400 hover:text-white hover:bg-[#1A1A1A] group">
                    <i data-lucide="${t.icon}" class="w-5 h-5 group-hover:text-stone-green"></i><span class="font-medium text-sm">${t.label}</span>
                </button>
            `).join('');
            switchTab('intro');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('#nav-buttons button').forEach(el => {
                el.classList.remove('bg-[#1A1A1A]', 'text-white', 'border-l-4', 'border-stone-green');
                el.classList.add('text-gray-400');
                el.style.borderLeft = '4px solid transparent';
            });
            document.getElementById(id).classList.add('active');
            const btn = document.getElementById(`btn-${id}`);
            btn.classList.remove('text-gray-400'); btn.classList.add('bg-[#1A1A1A]', 'text-white'); btn.style.borderLeft = '4px solid #00A868';
            if(id === 'diagnosis') setTimeout(initDiagCharts, 100);
            if(id === 'simulator') setTimeout(initProfitChart, 100);
        }

        function handleChatKey(e) { if(e.key === 'Enter') sendMessage(); }
        function askQuestion(t) { document.getElementById('chat-input').value = (t==='prejuizo'?'Por que daria prejuízo?':(t==='solucao'?'Como a solução 87% resolve?':'Quais as métricas finais?')); sendMessage(); }

        // --- CHART INITS ---
        function initDiagCharts() {
            if(window.diagChartsInit) return;
            new Chart(document.getElementById('velocityChart'), { type: 'bar', data: { labels: ['Legítimo', 'Fraude'], datasets: [{ data: [99, 1.8], backgroundColor: ['#3b82f6', '#ef4444'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic' } } } });
            new Chart(document.getElementById('valueChart'), { type: 'bar', data: { labels: ['Legítimo', 'Fraude'], datasets: [{ data: [130, 1660], backgroundColor: ['#3b82f6', '#ef4444'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });
            new Chart(document.getElementById('hourChart'), { type: 'line', data: { labels: ['0h','6h','12h','18h','23h'], datasets: [{ label: 'Risco', data: [80, 20, 10, 30, 70], borderColor: '#ef4444', fill: true }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false } } } });
            window.diagChartsInit = true;
        }

        function initProfitChart() {
            const ctx = document.getElementById('profitChart').getContext('2d');
            const labels = []; const data = []; const bg = [];
            
            for(let i=50; i<=95; i+=2) {
                labels.push(i + '%');
                // Lógica de interpolação visual do gráfico
                let net;
                if(i <= 87) {
                    const r = (i - 50) / (87 - 50);
                    net = -40927 + r * (44990 - (-40927));
                } else {
                    const r = (i - 87) / (100 - 87);
                    net = 44990 * (1 - r);
                }
                data.push(net);
                bg.push(net >= 0 ? '#00A868' : '#ef4444');
            }
            
            if(window.profitChartInst) window.profitChartInst.destroy();
            window.profitChartInst = new Chart(ctx, { 
                type: 'bar', 
                data: { labels: labels, datasets: [{ label: 'Lucro Líquido', data: data, backgroundColor: bg, borderRadius: 4 }] }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } }, 
                    scales: { x: { grid: { display: false }, ticks: { color: '#888' } }, y: { grid: { color: '#333' }, ticks: { color: '#888', callback: function(value) { return 'R$ ' + value/1000 + 'k'; } } } } 
                } 
            });
        }
    </script>
</body>
</html>
