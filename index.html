<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Case Stone (Paulo)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { background-color: #0f0f0f; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        
        /* Cores Stone */
        .text-green-stone { color: #00A868; }
        .bg-green-stone { background-color: #00A868; }
        .border-green-stone { border-color: #00A868; }
        
        /* Custom Cards */
        .card { background: #18181b; border: 1px solid #27272a; border-radius: 12px; }
        .card:hover { border-color: #3f3f46; }

        /* Slider Customizado */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #00A868; cursor: pointer; margin-top: -6px; 
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #333; border-radius: 2px;
        }

        /* Tabs */
        .nav-btn.active { background: #27272a; color: white; border-left: 3px solid #00A868; }
        .section-view { display: none; }
        .section-view.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-[#121212] border-r border-[#27272a] flex flex-col p-4">
        <div class="mb-8 px-2 flex items-center gap-2">
            <div class="w-8 h-8 bg-green-stone rounded flex items-center justify-center font-bold text-black">S</div>
            <div>
                <h1 class="font-bold text-white tracking-tight">Stone Case</h1>
                <p class="text-[10px] text-gray-500 font-mono">v2.0_FINAL_DATA</p>
            </div>
        </div>

        <nav class="space-y-1 flex-1">
            <button onclick="mudarAba('visao-geral')" id="btn-visao-geral" class="nav-btn w-full text-left px-4 py-3 rounded text-sm text-gray-400 hover:text-white transition-all flex items-center gap-3 active">
                <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Vis√£o Geral
            </button>
            <button onclick="mudarAba('analise-fraude')" id="btn-analise-fraude" class="nav-btn w-full text-left px-4 py-3 rounded text-sm text-gray-400 hover:text-white transition-all flex items-center gap-3">
                <i data-lucide="search" class="w-4 h-4"></i> An√°lise de Fraude
            </button>
            <button onclick="mudarAba('simulador')" id="btn-simulador" class="nav-btn w-full text-left px-4 py-3 rounded text-sm text-gray-400 hover:text-white transition-all flex items-center gap-3">
                <i data-lucide="sliders" class="w-4 h-4"></i> Simulador P&L
            </button>
        </nav>

        <div class="pt-4 border-t border-[#27272a]">
            <div class="flex items-center gap-3 px-2">
                <div class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center text-xs">P</div>
                <div>
                    <p class="text-sm font-medium">Paulo</p>
                    <p class="text-xs text-gray-500">Candidato</p>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 bg-[#0f0f0f] p-8 overflow-y-auto">
        
        <div class="flex justify-between items-end mb-8 pb-4 border-b border-[#27272a]">
            <div>
                <p class="text-xs font-bold text-green-stone uppercase mb-1">Resultado da An√°lise</p>
                <h2 class="text-3xl font-bold text-white">Estrat√©gia de Risco & Preven√ß√£o</h2>
            </div>
            <div class="text-right">
                <span class="text-xs text-gray-500 block">Status da Base</span>
                <span class="px-2 py-1 bg-green-900/30 text-green-400 text-xs rounded border border-green-900/50">Processado (11k transa√ß√µes)</span>
            </div>
        </div>

        <div id="visao-geral" class="section-view active max-w-5xl">
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="card p-5">
                    <p class="text-gray-500 text-xs uppercase font-bold">Volume Analisado</p>
                    <p class="text-2xl font-bold text-white mt-1">R$ 1.43 Mi</p>
                    <p class="text-xs text-red-400 mt-2 flex items-center gap-1"><i data-lucide="arrow-down" class="w-3 h-3"></i> Menor que esperado</p>
                </div>
                <div class="card p-5">
                    <p class="text-gray-500 text-xs uppercase font-bold">Ticket M√©dio</p>
                    <p class="text-2xl font-bold text-white mt-1">R$ 130,02</p>
                    <p class="text-xs text-gray-400 mt-2">Varejo Comum</p>
                </div>
                <div class="card p-5">
                    <p class="text-gray-500 text-xs uppercase font-bold">Performance (AUC)</p>
                    <p class="text-2xl font-bold text-green-stone mt-1">0.8859</p>
                    <p class="text-xs text-gray-400 mt-2">Modelo Random Forest</p>
                </div>
                <div class="card p-5 border-green-stone/30">
                    <p class="text-gray-500 text-xs uppercase font-bold">Resultado L√≠quido</p>
                    <p class="text-2xl font-bold text-green-stone mt-1">R$ 44.9k</p>
                    <p class="text-xs text-gray-400 mt-2">Cen√°rio Otimizado (87%)</p>
                </div>
            </div>

            <div class="card p-8 border-l-4 border-green-stone">
                <h3 class="text-xl font-bold mb-4">O "Pulo do Gato" üêà</h3>
                <p class="text-gray-300 leading-relaxed mb-4">
                    Quando rodei a an√°lise, o volume de <strong>R$ 1,4 milh√£o</strong> e o ticket de <strong>R$ 130</strong> acenderam um alerta. 
                    Nesse cen√°rio de margem apertada, bloquear falsos positivos (clientes bons) custa muito caro.
                </p>
                <div class="grid grid-cols-2 gap-8 mt-6 p-4 bg-black/20 rounded-lg">
                    <div>
                        <p class="text-red-400 font-bold mb-1">Cen√°rio Padr√£o (50%)</p>
                        <p class="text-sm text-gray-400">Bloqueia muita venda boa. A opera√ß√£o teria um <strong>preju√≠zo de R$ 40 mil</strong>.</p>
                    </div>
                    <div>
                        <p class="text-green-stone font-bold mb-1">Minha Solu√ß√£o (87%)</p>
                        <p class="text-sm text-gray-400">S√≥ bloqueia se tiver certeza. Reverte para <strong>lucro de R$ 45 mil</strong>.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="analise-fraude" class="section-view max-w-6xl">
            <div class="grid grid-cols-3 gap-6">
                <div class="card p-6">
                    <p class="font-bold mb-4 flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4 text-green-stone"></i> Velocidade (Bot)</p>
                    <div class="h-40"><canvas id="chartVelocidade"></canvas></div>
                    <p class="text-xs text-gray-400 mt-2">Fraudes ocorrem em intervalos de < 2 min.</p>
                </div>
                <div class="card p-6">
                    <p class="font-bold mb-4 flex items-center gap-2"><i data-lucide="dollar-sign" class="w-4 h-4 text-green-stone"></i> Ticket M√©dio</p>
                    <div class="h-40"><canvas id="chartValor"></canvas></div>
                    <p class="text-xs text-gray-400 mt-2">Fraudador gasta 12x mais que cliente real.</p>
                </div>
                <div class="card p-6">
                    <p class="font-bold mb-4 flex items-center gap-2"><i data-lucide="bar-chart-2" class="w-4 h-4 text-green-stone"></i> Import√¢ncia (SHAP)</p>
                    <div class="space-y-3 mt-4">
                        <div>
                            <div class="flex justify-between text-xs mb-1"><span>Delta T (Tempo)</span> <span>73%</span></div>
                            <div class="w-full bg-gray-700 h-1.5 rounded"><div class="bg-green-stone h-1.5 rounded" style="width: 73%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1"><span>Valor (Amount)</span> <span>18%</span></div>
                            <div class="w-full bg-gray-700 h-1.5 rounded"><div class="bg-blue-500 h-1.5 rounded" style="width: 18%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1"><span>Hora</span> <span>9%</span></div>
                            <div class="w-full bg-gray-700 h-1.5 rounded"><div class="bg-purple-500 h-1.5 rounded" style="width: 9%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 card p-6">
                <h4 class="font-bold mb-2">Aplica√ß√£o na Base de Teste (Aba 2)</h4>
                <p class="text-sm text-gray-400 mb-4">Resultado do modelo Random Forest aplicado nas 11.820 novas transa√ß√µes.</p>
                <div class="flex items-center gap-8">
                    <div>
                        <p class="text-3xl font-bold text-white">242</p>
                        <p class="text-xs text-gray-500 uppercase">Transa√ß√µes Bloqueadas</p>
                    </div>
                    <div class="h-10 w-px bg-gray-700"></div>
                    <div>
                        <p class="text-3xl font-bold text-green-stone">R$ 55k</p>
                        <p class="text-xs text-gray-500 uppercase">Fraude Prevenida</p>
                    </div>
                    <div class="flex-1 text-right">
                         <button class="bg-[#27272a] hover:bg-[#3f3f46] text-white px-4 py-2 rounded text-xs flex items-center gap-2 ml-auto">
                            <i data-lucide="download" class="w-3 h-3"></i> Baixar Relat√≥rio .xlsx
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="simulador" class="section-view max-w-6xl">
            <div class="grid grid-cols-12 gap-6">
                <div class="col-span-4 space-y-6">
                    <div class="card p-6 border-t-4 border-green-stone">
                        <h3 class="font-bold text-lg mb-1">Calibra√ß√£o do Modelo</h3>
                        <p class="text-xs text-gray-400 mb-6">Ajuste o corte (threshold) para ver o impacto no P&L.</p>
                        
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-xs uppercase font-bold text-gray-500">Threshold</span>
                            <span class="text-3xl font-bold text-green-stone" id="disp-thresh">87%</span>
                        </div>
                        <input type="range" id="sim-slider" min="50" max="95" value="87" class="w-full mb-6">
                        
                        <div class="space-y-3 pt-4 border-t border-[#27272a]">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-400">Fraude Evitada</span>
                                <span class="text-sm font-bold text-green-400" id="disp-saving">R$ 55k</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-400">Vendas Perdidas</span>
                                <span class="text-sm font-bold text-red-400" id="disp-loss">R$ 10k</span>
                            </div>
                            <div class="flex justify-between bg-black/30 p-3 rounded mt-2">
                                <span class="text-sm font-bold text-white">Lucro L√≠quido</span>
                                <span class="text-lg font-bold text-green-stone" id="disp-net">R$ 44k</span>
                            </div>
                        </div>

                        <div id="alert-box" class="mt-4 p-3 bg-red-900/20 border border-red-900/50 rounded hidden">
                            <p class="text-xs text-red-300">‚ö†Ô∏è <strong>Aten√ß√£o:</strong> Nesse n√≠vel, o custo de falsos positivos gera preju√≠zo operacional.</p>
                        </div>
                    </div>
                </div>

                <div class="col-span-8 card p-6 flex flex-col">
                    <h4 class="text-sm font-bold text-gray-400 uppercase mb-4">Curva de Lucratividade</h4>
                    <div class="flex-1 relative">
                        <canvas id="chartProfit"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        lucide.createIcons();

        // Dados extra√≠dos da an√°lise Python (Hardcoded para performance)
        const DATA_SIM = {
            p50: { net: -40927, savings: 81089, loss: 122017 },
            p87: { net: 44990, savings: 55840, loss: 10849 }
        };

        // Estado inicial
        let currentThresh = 87;

        // Fun√ß√µes de UI
        function mudarAba(id) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
        }

        function formatMoney(val) {
            return val.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL', maximumFractionDigits: 0});
        }

        // L√≥gica do Simulador (Interpola√ß√£o simples entre os pontos conhecidos do Python)
        function updateSim(val) {
            val = parseInt(val);
            document.getElementById('disp-thresh').innerText = val + '%';
            
            let net, savings, loss;
            
            // Interpola√ß√£o entre 50% e 87%
            if (val <= 87) {
                const ratio = (val - 50) / 37; // (87-50)
                savings = 81089 - (ratio * (81089 - 55840));
                loss = 122017 - (ratio * (122017 - 10849));
            } else {
                // Acima de 87% (Queda brusca)
                const ratio = (val - 87) / 13;
                savings = 55840 * (1 - ratio * 0.6);
                loss = 10849 * (1 - ratio);
            }
            net = savings - loss;

            // Update DOM
            document.getElementById('disp-saving').innerText = formatMoney(savings);
            document.getElementById('disp-loss').innerText = formatMoney(loss);
            const elNet = document.getElementById('disp-net');
            elNet.innerText = formatMoney(net);

            // Cores e Alertas
            const alertBox = document.getElementById('alert-box');
            if (net < 0) {
                elNet.className = "text-lg font-bold text-red-500";
                alertBox.classList.remove('hidden');
            } else {
                elNet.className = "text-lg font-bold text-green-stone";
                alertBox.classList.add('hidden');
            }
        }

        // Listener do Slider
        document.getElementById('sim-slider').addEventListener('input', (e) => updateSim(e.target.value));

        // Inicializar Gr√°ficos Chart.js
        window.addEventListener('load', () => {
            // Chart Velocidade
            new Chart(document.getElementById('chartVelocidade'), {
                type: 'bar',
                data: { labels: ['Leg√≠timo', 'Fraude'], datasets: [{ data: [99, 1.8], backgroundColor: ['#3b82f6', '#ef4444'] }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic', grid: {color: '#333'} }, x: { grid: {display: false} } } }
            });

            // Chart Valor
            new Chart(document.getElementById('chartValor'), {
                type: 'bar',
                data: { labels: ['Leg√≠timo', 'Fraude'], datasets: [{ data: [130, 1660], backgroundColor: ['#3b82f6', '#ef4444'] }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: {color: '#333'} }, x: { grid: {display: false} } } }
            });

            // Chart Profit Curve (Gerado dinamicamente)
            const profitLabels = [];
            const profitData = [];
            const profitColors = [];
            
            for(let i=50; i<=95; i+=2) {
                profitLabels.push(i+'%');
                // Mesma l√≥gica de interpola√ß√£o
                let n;
                if(i <= 87) {
                    const r = (i - 50) / 37;
                    n = -40927 + r * (44990 - (-40927));
                } else {
                    const r = (i - 87) / 13;
                    n = 44990 * (1 - r);
                }
                profitData.push(n);
                profitColors.push(n >= 0 ? '#00A868' : '#ef4444');
            }

            new Chart(document.getElementById('chartProfit'), {
                type: 'bar',
                data: { labels: profitLabels, datasets: [{ data: profitData, backgroundColor: profitColors, borderRadius: 4 }] },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { grid: {color: '#333'}, ticks: { color: '#888', callback: v => 'R$ ' + v/1000 + 'k' } },
                        x: { grid: {display: false}, ticks: { color: '#888' } }
                    }
                }
            });

            // Inicia simulador
            updateSim(87);
        });

    </script>
</body>
</html>
