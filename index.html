<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stone Case - Risco & Fraude</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Base Styles - Dark Mode Stone */
        body { background-color: #0e0e0e; color: #e5e5e5; font-family: 'Inter', sans-serif; antialiased; }
        
        .stone-green { color: #00A868; }
        .bg-stone-green { background-color: #00A868; }
        .border-stone-green { border-color: #00A868; }
        
        /* Card Styling */
        .card { 
            background: #18181b; 
            border: 1px solid #27272a; 
            border-radius: 8px; 
        }
        
        /* Custom Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #00A868; cursor: pointer; margin-top: -6px; border: 2px solid #18181b;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #3f3f46; border-radius: 2px;
        }

        /* Navigation Tabs */
        .nav-item { cursor: pointer; border-bottom: 2px solid transparent; color: #71717a; transition: all 0.2s; }
        .nav-item:hover { color: #d4d4d8; }
        .nav-item.active { border-bottom-color: #00A868; color: #00A868; font-weight: 600; }

        .view-section { display: none; }
        .view-section.active { display: block; }

        /* Scrollbar discreta */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <header class="h-16 border-b border-[#27272a] bg-[#121212] flex items-center justify-between px-8 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-[#00A868] rounded flex items-center justify-center font-bold text-black">S</div>
            <div>
                <h1 class="text-sm font-bold text-white tracking-wide">STONE <span class="text-gray-500 font-normal">| Data Science Case</span></h1>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <div class="text-right">
                <p class="text-[10px] text-gray-500 uppercase font-bold">Candidato</p>
                <p class="text-xs text-white">Paulo</p>
            </div>
            <div class="h-8 w-px bg-[#27272a]"></div>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span class="text-xs text-gray-400">Model v1.0 (Prod)</span>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 bg-[#121212] border-r border-[#27272a] flex flex-col pt-6">
            <nav class="space-y-1 px-3">
                <a onclick="setView('dashboard')" id="nav-dashboard" class="nav-btn flex items-center gap-3 px-3 py-2 text-sm rounded-md bg-[#27272a] text-white cursor-pointer">
                    <i data-lucide="layout-grid" class="w-4 h-4"></i> Dashboard Executivo
                </a>
                <a onclick="setView('technical')" id="nav-technical" class="nav-btn flex items-center gap-3 px-3 py-2 text-sm rounded-md text-gray-400 hover:text-white hover:bg-[#18181b] cursor-pointer">
                    <i data-lucide="bar-chart-2" class="w-4 h-4"></i> Análise Técnica
                </a>
                <a onclick="setView('simulator')" id="nav-simulator" class="nav-btn flex items-center gap-3 px-3 py-2 text-sm rounded-md text-gray-400 hover:text-white hover:bg-[#18181b] cursor-pointer">
                    <i data-lucide="sliders" class="w-4 h-4"></i> Simulador ROI
                </a>
                <div class="my-4 border-t border-[#27272a]"></div>
                <p class="px-3 text-[10px] uppercase text-gray-600 font-bold mb-2">Suporte</p>
                <a onclick="setView('faq')" id="nav-faq" class="nav-btn flex items-center gap-3 px-3 py-2 text-sm rounded-md text-gray-400 hover:text-white hover:bg-[#18181b] cursor-pointer">
                    <i data-lucide="file-text" class="w-4 h-4"></i> Notas Técnicas (FAQ)
                </a>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto bg-[#0e0e0e] p-8">
            
            <div id="dashboard" class="view-section active max-w-6xl mx-auto">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-white mb-2">Diagnóstico da Operação</h2>
                    <p class="text-gray-400 text-sm">Análise de impacto financeiro baseada no volume de R$ 1.4 Mi processado.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="card p-5">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] uppercase font-bold text-gray-500">Volume Total</span>
                            <i data-lucide="database" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <span class="text-2xl font-bold text-white">R$ 1.43 Mi</span>
                        <div class="mt-2 text-xs text-red-400 flex items-center gap-1">
                            <i data-lucide="alert-circle" class="w-3 h-3"></i> Menor que previsto
                        </div>
                    </div>

                    <div class="card p-5">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] uppercase font-bold text-gray-500">Ticket Médio</span>
                            <i data-lucide="credit-card" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        <span class="text-2xl font-bold text-white">R$ 130,02</span>
                        <div class="mt-2 text-xs text-gray-400">Perfil Varejo (Margem Baixa)</div>
                    </div>

                    <div class="card p-5">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] uppercase font-bold text-gray-500">Modelo (AUC)</span>
                            <i data-lucide="activity" class="w-4 h-4 text-[#00A868]"></i>
                        </div>
                        <span class="text-2xl font-bold text-[#00A868]">0.8859</span>
                        <div class="mt-2 text-xs text-gray-400">Random Forest</div>
                    </div>

                    <div class="card p-5 border border-[#00A868] bg-[#00A868]/5">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] uppercase font-bold text-[#00A868]">Lucro Projetado</span>
                            <i data-lucide="trending-up" class="w-4 h-4 text-[#00A868]"></i>
                        </div>
                        <span class="text-2xl font-bold text-[#00A868]">+ R$ 44.9k</span>
                        <div class="mt-2 text-xs text-[#00A868]">Cenário Otimizado (87%)</div>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-6">
                    <div class="col-span-2 card p-6">
                        <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                            <i data-lucide="scale" class="w-4 h-4 text-gray-400"></i> Análise de Viabilidade
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-red-900/10 border border-red-900/30 p-4 rounded text-sm">
                                <strong class="block text-red-400 mb-1">Cenário Padrão (Corte 50%)</strong>
                                <p class="text-gray-400">Com ticket de R$ 130, bloquear falsos positivos custa caro. Neste cenário, perderíamos R$ 122k em vendas legítimas, resultando em um <span class="text-red-400 font-bold">prejuízo operacional de R$ 40 mil</span>.</p>
                            </div>
                            <div class="bg-emerald-900/10 border border-emerald-900/30 p-4 rounded text-sm">
                                <strong class="block text-[#00A868] mb-1">Cenário Recomendado (Corte 87%)</strong>
                                <p class="text-gray-400">Aumentando o rigor, reduzimos os falsos positivos drasticamente. Isolamos os ataques de robôs e revertemos o resultado para um <span class="text-[#00A868] font-bold">lucro líquido de R$ 45 mil</span>.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card p-6 flex flex-col justify-center text-center">
                        <div class="mb-4">
                            <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Ação na Base Teste (Aba 2)</span>
                        </div>
                        <div class="text-5xl font-bold text-white mb-2">242</div>
                        <div class="text-sm text-[#00A868] font-medium mb-4">Transações Bloqueadas</div>
                        <p class="text-xs text-gray-500 px-4">Representa ~2% da base, focada exclusivamente em comportamento não-humano.</p>
                    </div>
                </div>
            </div>

            <div id="technical" class="view-section max-w-6xl mx-auto">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-white">Detalhamento do Modelo</h2>
                    <p class="text-sm text-gray-400">Feature Engineering e Comportamento da Fraude.</p>
                </div>

                <div class="grid grid-cols-2 gap-6 mb-6">
                    <div class="card p-6">
                        <h3 class="text-sm font-bold text-gray-300 mb-6">SHAP Values (Importância Global)</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs mb-1 text-gray-400">
                                    <span>Delta T (Tempo entre transações)</span>
                                    <span>73%</span>
                                </div>
                                <div class="w-full bg-[#27272a] h-2 rounded-full overflow-hidden">
                                    <div class="bg-[#00A868] h-full" style="width: 73%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1 text-gray-400">
                                    <span>Valor da Transação</span>
                                    <span>18%</span>
                                </div>
                                <div class="w-full bg-[#27272a] h-2 rounded-full overflow-hidden">
                                    <div class="bg-blue-600 h-full" style="width: 18%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1 text-gray-400">
                                    <span>Hora do Dia</span>
                                    <span>9%</span>
                                </div>
                                <div class="w-full bg-[#27272a] h-2 rounded-full overflow-hidden">
                                    <div class="bg-purple-600 h-full" style="width: 9%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 p-3 bg-[#27272a] rounded text-xs text-gray-400">
                            <strong>Interpretação:</strong> O modelo aprendeu que o <em>timing</em> (ataques rápidos) é o preditor mais forte de fraude, mais do que o valor em si.
                        </div>
                    </div>

                    <div class="card p-6">
                        <h3 class="text-sm font-bold text-gray-300 mb-4">Padrão da Fraude</h3>
                        <div class="h-48">
                            <canvas id="velocityChart"></canvas>
                        </div>
                        <p class="text-center text-xs text-gray-500 mt-2">Intervalo médio entre compras (Minutos)</p>
                    </div>
                </div>
            </div>

            <div id="simulator" class="view-section max-w-6xl mx-auto">
                <div class="grid grid-cols-12 gap-6 h-full">
                    
                    <div class="col-span-4 flex flex-col gap-6">
                        <div class="card p-6 border-l-4 border-[#00A868]">
                            <h3 class="font-bold text-white mb-1">Calibrar Threshold</h3>
                            <p class="text-xs text-gray-400 mb-6">Ajuste a sensibilidade para ver o P&L.</p>
                            
                            <div class="flex justify-between items-end mb-2">
                                <span class="text-xs uppercase font-bold text-gray-500">Corte</span>
                                <span class="text-3xl font-bold text-[#00A868]" id="lbl-threshold">87%</span>
                            </div>
                            <input type="range" id="sim-slider" min="50" max="95" value="87" class="w-full mb-6 accent-[#00A868]">
                            
                            <div class="space-y-3 pt-4 border-t border-[#27272a]">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Economia (Fraude)</span>
                                    <span class="text-sm font-bold text-blue-400" id="val-savings">R$ 55k</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-400">Perda (Falsos Pos.)</span>
                                    <span class="text-sm font-bold text-red-400" id="val-loss">R$ 10k</span>
                                </div>
                                <div class="mt-4 p-3 bg-[#000] rounded flex justify-between items-center border border-[#27272a]">
                                    <span class="text-xs font-bold text-gray-400 uppercase">Resultado</span>
                                    <span class="text-lg font-bold text-[#00A868]" id="val-net">R$ 44k</span>
                                </div>
                            </div>
                        </div>

                        <div id="loss-warning" class="hidden p-4 bg-red-900/10 border border-red-900/30 rounded text-xs text-red-300">
                            <strong>Alerta de Prejuízo:</strong> Threshold muito baixo. O custo de fricção supera a economia de fraude.
                        </div>
                    </div>

                    <div class="col-span-8 card p-6 flex flex-col">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-gray-400 uppercase">Curva de Lucratividade</h3>
                            <div class="flex gap-4 text-xs">
                                <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-red-500"></div> Prejuízo</div>
                                <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-[#00A868]"></div> Lucro</div>
                            </div>
                        </div>
                        <div class="flex-1 relative w-full h-full min-h-[300px]">
                            <canvas id="profitChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="faq" class="view-section max-w-4xl mx-auto">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-white">Notas Técnicas</h2>
                    <p class="text-sm text-gray-400">Resumo de decisões arquiteturais e estratégia de deploy.</p>
                </div>

                <div class="space-y-4">
                    <div class="card p-5">
                        <h3 class="text-sm font-bold text-[#00A868] mb-2 flex items-center gap-2">
                            <i data-lucide="database" class="w-4 h-4"></i> Feature Store & Latência
                        </h3>
                        <p class="text-sm text-gray-300 leading-relaxed">
                            Para calcular o <code>delta_t</code> em tempo real (< 100ms), não podemos consultar o Data Lake. 
                            <strong>Estratégia:</strong> Utilizar Redis ou DynamoDB como Feature Store online, armazenando apenas o 
                            <em>last_transaction_timestamp</em> por <code>card_id</code>.
                        </p>
                    </div>

                    <div class="card p-5">
                        <div class="flex justify-between">
                            <h3 class="text-sm font-bold text-[#00A868] mb-2 flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i> Monitoramento & Drift
                            </h3>
                        </div>
                        <p class="text-sm text-gray-300 leading-relaxed">
                            Monitoramento contínuo via <strong>PSI (Population Stability Index)</strong> na distribuição dos scores. 
                            Se o padrão de fraude mudar (ex: ataques mais lentos), o PSI dispara alerta para retreino.
                        </p>
                    </div>

                    <div class="card p-5">
                        <h3 class="text-sm font-bold text-[#00A868] mb-2 flex items-center gap-2">
                            <i data-lucide="shield-check" class="w-4 h-4"></i> Decisão nos "Cinzentos"
                        </h3>
                        <p class="text-sm text-gray-300 leading-relaxed">
                            Scores entre 50% e 86% não devem ser bloqueados, mas desafiados.
                            <strong>Ação:</strong> Step-up authentication (3DS 2.0 ou SMS challenge) para salvar a venda legítima.
                        </p>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // Init Icons
        lucide.createIcons();

        // --- NAVIGATION LOGIC ---
        function setView(viewId) {
            // Hide all sections
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            // Reset nav buttons
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('bg-[#27272a]', 'text-white');
                el.classList.add('text-gray-400');
            });

            // Activate chosen
            document.getElementById(viewId).classList.add('active');
            const activeBtn = document.getElementById('nav-' + viewId);
            activeBtn.classList.remove('text-gray-400');
            activeBtn.classList.add('bg-[#27272a]', 'text-white');

            // Trigger Chart resize if needed
            if(viewId === 'simulator' || viewId === 'technical') {
                window.dispatchEvent(new Event('resize'));
            }
        }

        // --- SIMULATOR LOGIC ---
        // Data points from Python Analysis
        // 50% -> Net: -40.927
        // 87% -> Net: +44.990
        
        function updateSimulator(val) {
            const threshold = parseInt(val);
            document.getElementById('lbl-threshold').innerText = threshold + '%';

            let net, savings, loss;
            
            // Linear Interpolation Logic
            if (threshold <= 87) {
                // From 50 to 87
                const ratio = (threshold - 50) / 37;
                savings = 81089 - (ratio * (81089 - 55840));
                loss = 122017 - (ratio * (122017 - 10849));
            } else {
                // From 87 to 95 (Rapid dropoff)
                const ratio = (threshold - 87) / 8;
                savings = 55840 * (1 - ratio * 0.7); // Frauds pass through
                loss = 10849 * (1 - ratio); // Almost no false positives
            }
            net = savings - loss;

            // Update DOM
            document.getElementById('val-savings').innerText = formatCurrency(savings);
            document.getElementById('val-loss').innerText = formatCurrency(loss);
            
            const netEl = document.getElementById('val-net');
            netEl.innerText = formatCurrency(net);
            
            const warningEl = document.getElementById('loss-warning');

            if (net < 0) {
                netEl.className = "text-lg font-bold text-red-500";
                warningEl.classList.remove('hidden');
            } else {
                netEl.className = "text-lg font-bold text-[#00A868]";
                warningEl.classList.add('hidden');
            }
        }

        function formatCurrency(val) {
            return val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });
        }

        document.getElementById('sim-slider').addEventListener('input', (e) => updateSimulator(e.target.value));

        // --- CHARTS INIT ---
        window.addEventListener('load', () => {
            
            // 1. Velocity Chart
            const ctxVel = document.getElementById('velocityChart').getContext('2d');
            new Chart(ctxVel, {
                type: 'bar',
                data: {
                    labels: ['Legítimo', 'Fraude'],
                    datasets: [{
                        label: 'Minutos',
                        data: [99, 1.8],
                        backgroundColor: ['#27272a', '#ef4444'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { type: 'logarithmic', grid: { color: '#27272a' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // 2. Profit Chart (Dynamic Colors)
            const ctxProfit = document.getElementById('profitChart').getContext('2d');
            
            // Generate Data Points
            const labels = [];
            const data = [];
            const colors = [];

            for(let i=50; i<=95; i+=1) {
                labels.push(i + '%');
                let n;
                if(i <= 87) {
                    const r = (i - 50) / 37;
                    n = -40927 + r * (44990 - (-40927));
                } else {
                    const r = (i - 87) / 8;
                    n = 44990 * (1 - r);
                }
                data.push(n);
                colors.push(n >= 0 ? '#00A868' : '#ef4444');
            }

            new Chart(ctxProfit, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.raw.toLocaleString('pt-BR');
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#27272a' },
                            ticks: { color: '#71717a', callback: (v) => 'R$ ' + v/1000 + 'k' }
                        },
                        x: { grid: { display: false }, ticks: { display: false } }
                    }
                }
            });

            // Init Simulator
            updateSimulator(87);
        });

    </script>
</body>
</html>
